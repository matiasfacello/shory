// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgres"
  url      = env("DATABASE_URL")
}

// Necessary for Next auth
model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? // @db.Text
  access_token      String? // @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? // @db.Text
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model User {
  id            String         @id @default(cuid())
  name          String?
  email         String?        @unique
  emailVerified DateTime?
  image         String?
  role          String?
  accounts      Account[]
  sessions      Session[]
  SLink         SLink[]
  Subscription  Subscription[]
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model SLink {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  url       String   @db.VarChar(2000)
  slug      String   @unique
  tags      String?

  utm_source   String?
  utm_campaign String?
  utm_medium   String?
  utm_term     String?
  utm_content  String?

  userId       String?
  user         User?          @relation(fields: [userId], references: [id], onDelete: Cascade)
  SLinkClicks  SLinkClicks[]
  Subscription Subscription[]

  @@index(slug)
}

model SLinkClicks {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  linkId    Int
  link      SLink    @relation(fields: [linkId], references: [id], onDelete: Cascade)
  slug      String
  url       String   @db.VarChar(2000)
  ip        String?
  geo       String?
}

model Plans {
  id           Int            @id @default(autoincrement())
  name         String
  linkQuota    String
  clickQuota   String
  Subscription Subscription[]
}

model Subscription {
  id         Int      @id @default(autoincrement())
  userId     String
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  planId     Int
  plans      Plans    @relation(fields: [planId], references: [id], onDelete: Cascade)
  linkUsage  String?
  clickUsage String?
  startDate  DateTime
  endDate    DateTime
  paymentId  Int
  SLink      SLink?   @relation(fields: [sLinkId], references: [id])
  sLinkId    Int?
}

// ----------------- SCHEMA FOR DBDIAGRAM.io

// Table Account {
//   id string [pk, increment]
//   userId string
//   type string
//   provider string
//   providerAccountId string
//   refresh_token string
//   access_token string
//   expires_at int
//   token_type string
//   scope string
//   id_token string
//   session_state string
//   user string [ref: > User.id]
// }

// Table Session {
//   id           string   [pk, increment]
//   sessionToken string
//   userId       string
//   expires      datetime
//   user string [ref: > User.id]
// }

// Table User {
//   id            string    [pk]
//   name string
//   email         string
//   emailVerified datetime
//   image         string
//   role          string
//   accounts string [ref: > Account.id]
//   sessions string [ref: > Session.id]
//   SLink         SLink[]
// }

// Table VerificationToken {
//   identifier string
//   token      string
//   expires    datetime
// }

// Table SLink {
//   id int [pk, increment]
//   createdAt datetime 
//   url string   
//   slug string

//   utm_source   string
//   utm_campaign string
//   utm_medium   string
//   utm_term     string
//   utm_content  string

//   userId      string
//   user string [ref: > User.id]
//   SLinkClicks int [ref: > SLinkClicks.id]

// }

// Table SLinkClicks {
//   id        int      [pk, increment]
//   createdAt datetime
//   linkId    int [ref: > SLink.id]
//   slug      string
//   url       string
//   ip        string
//   geo       string
// }

// Table Plans {
//   id int [pk, increment]
//   name string
//   linkQuota string
//   clickQuota string
// }

// Table Subscription {
//   id int [pk, increment]
//   userId string [ref: > User.id]
//   planId int [ref: > Plans.id]
//   linkUsage string
//   clickUsage string
//   startDate  datetime
//   endDate datetime
//   paymentId int 
// }

// Table Payments {
//   id int [pk, increment]
//   userId string [ref: > User.id]
//   subscriptionId int [ref: > Subscription.id]
//   processor string
//   processorId string
//   price string
//   createdAt datetime
// }

// Table Tree {
//   id int [pk, increment]
//   userId string [ref: > User.id]
//   order int
//   name string
//   value string
//   url string
//   image string
//   bgColor string
//   textColor string
//   size string
//   createdAt datetime
// }

// }
